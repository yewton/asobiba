{"version":3,"file":"auth.bundle.js","sources":["../../ts/auth/common.ts","../../ts/auth/auth.ts","../../ts/auth/logout.ts","../../ts/auth/index.ts"],"sourcesContent":["export function setDisplay(selectors: string, display: 'none' | '') {\n    document.querySelectorAll<HTMLInputElement>(selectors)\n        .forEach((e) => {\n            e.style.display = display;\n        });\n}\n","import {setDisplay} from \"./common\";\n\nexport async function updateAuthStatus() {\n    const response = await fetch('/user/', {\n        headers: {\n            // きちんと指定しないと、↓に引っかからずに、ログイン後の戻り先として /user/ が保存されてしまう\n            // https://github.com/spring-projects/spring-security/blob/6.0.1/config/src/main/java/org/springframework/security/config/annotation/web/configurers/RequestCacheConfigurer.java#L157\n            'Accept': 'application/json'\n        }\n    });\n    if (response.ok) {\n        const data = await response.json();\n        const userEl = document.getElementById('user');\n        if (userEl) {\n            userEl.innerHTML = data.name;\n        }\n        setDisplay('.unauthenticated', 'none');\n        setDisplay('.authenticated', '');\n    }\n};\n","import {setDisplay} from \"./common\";\n\nconst csrfToken = document.querySelector('meta[name=\"_csrf\"]')?.getAttribute('content') || '';\nconst csrfHeader = document.querySelector('meta[name=\"_csrf_header\"]')?.getAttribute('content') || '';\n\nconst logoutButton = document.getElementById('button-logout');\n\nexport function setupLogoutButton() {\n    if (!logoutButton) {\n        return;\n    }\n    logoutButton.onclick = async () => {\n        const headers = new Headers();\n        if (0 < csrfHeader.length) {\n            headers.append(csrfHeader, csrfToken);\n        }\n        const response = await fetch('/logout', {\n            method: 'POST',\n            headers: headers\n        });\n        if (response.ok) {\n            setDisplay('.unauthenticated', '');\n            setDisplay('.authenticated', 'none');\n        }\n    };\n}\n","import 'vite/modulepreload-polyfill'\n\nimport {updateAuthStatus} from \"./auth\";\nimport {setupLogoutButton} from \"./logout\";\n\nsetupLogoutButton();\n\n(async () => {\n    await updateAuthStatus();\n})();\n"],"names":["setDisplay","selectors","display","e","updateAuthStatus","response","data","userEl","csrfToken","_a","csrfHeader","logoutButton","setupLogoutButton","headers"],"mappings":"ssBAAgB,SAAAA,EAAWC,EAAmBC,EAAsB,CAChE,SAAS,iBAAmCD,CAAS,EAChD,QAASE,GAAM,CACZA,EAAE,MAAM,QAAUD,CAAA,CACrB,CACT,CCHA,eAAsBE,GAAmB,CAC/B,MAAAC,EAAW,MAAM,MAAM,SAAU,CACnC,QAAS,CAGL,OAAU,kBACd,CAAA,CACH,EACD,GAAIA,EAAS,GAAI,CACP,MAAAC,EAAO,MAAMD,EAAS,OACtBE,EAAS,SAAS,eAAe,MAAM,EACzCA,IACAA,EAAO,UAAYD,EAAK,MAE5BN,EAAW,mBAAoB,MAAM,EACrCA,EAAW,iBAAkB,EAAE,CACnC,CACJ,OCjBA,MAAMQ,IAAYC,EAAA,SAAS,cAAc,oBAAoB,IAA3C,YAAAA,EAA8C,aAAa,aAAc,SAC3F,MAAMC,IAAaD,EAAA,SAAS,cAAc,2BAA2B,IAAlD,YAAAA,EAAqD,aAAa,aAAc,GAE7FE,EAAe,SAAS,eAAe,eAAe,EAErD,SAASC,GAAoB,CAC3BD,IAGLA,EAAa,QAAU,SAAY,CACzB,MAAAE,EAAU,IAAI,QAChB,EAAIH,EAAW,QACPG,EAAA,OAAOH,EAAYF,CAAS,GAEvB,MAAM,MAAM,UAAW,CACpC,OAAQ,OACR,QAAAK,CAAA,CACH,GACY,KACTb,EAAW,mBAAoB,EAAE,EACjCA,EAAW,iBAAkB,MAAM,EACvC,EAER,CCpBAY,KAEC,SACG,MAAMR,EAAiB"}